# ä»€ä¹ˆæ˜¯ JSON-serverï¼Ÿ
JSON-server æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„å°å‹æœ¬åœ°æœåŠ¡å™¨å·¥å…·ï¼Œå¯ä»¥è®©ä½ ç”¨ä¸€ä¸ª JSON æ–‡ä»¶å¿«é€Ÿæ¨¡æ‹Ÿå‡º RESTful API æ¥å£ã€‚å®ƒç‰¹åˆ«é€‚åˆå‰ç«¯å¼€å‘æ—¶æœ¬åœ°è°ƒè¯•ã€æ¨¡æ‹Ÿåç«¯æ•°æ®ï¼Œä¸ç”¨è‡ªå·±å†™åç«¯ä»£ç å°±èƒ½å®ç°å¢åˆ æ”¹æŸ¥ï¼ˆGET/POST/PUT/DELETEï¼‰ç­‰æ“ä½œ,å¯ä»¥å¿«é€Ÿç»™å‰ç«¯äººå‘˜æä¾›ä¸€ä¸ªåç«¯æ¥å£

## ä¸»è¦ç‰¹ç‚¹
- é›¶é…ç½®ï¼Œå‡ åˆ†é’Ÿå°±èƒ½æ­å»ºä¸€ä¸ªå‡æ•°æ®æ¥å£
- æ”¯æŒ RESTful é£æ ¼çš„ API
- å¯ä»¥è‡ªå®šä¹‰è·¯ç”±ã€æ¨¡æ‹Ÿåˆ†é¡µã€è¿‡æ»¤ã€æ’åºç­‰
- é€‚åˆå‰ç«¯ç»ƒä¹  AJAXã€fetchã€axios ç­‰å¼‚æ­¥è¯·æ±‚

## åŸºæœ¬ç”¨æ³•
1. å®‰è£… Node.js å’Œ json-server
2. æ–°å»ºä¸€ä¸ª db.json æ–‡ä»¶ï¼Œå†™å¥½ä½ çš„å‡æ•°æ®
3. å¯åŠ¨ json-serverï¼Œè®¿é—®æœ¬åœ°æ¥å£ï¼ˆå¦‚ http://localhost:3000/users ï¼‰

# JSON-server å®‰è£…æ–¹æ³•
1. ç¡®ä¿å·²å®‰è£… Node.js ï¼šå¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥ node -v æ£€æŸ¥ã€‚
2. å…¨å±€å®‰è£… json-server ï¼šåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š
   ```
   npmÂ installÂ -gÂ json-server
   ```
3. æœ¬åœ°å®‰è£…ä¹Ÿå¯ä»¥ ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœåªæƒ³åœ¨å½“å‰é¡¹ç›®ç”¨ï¼Œå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹è¾“å…¥ï¼š
   ```
   npmÂ installÂ json-serverÂ --save-dev
   ```
4. å®‰è£…å®Œæˆå ï¼Œä½ å¯ä»¥ç”¨ json-server --version æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸã€‚

## å¯åŠ¨ json-server
1. åœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥ä½ çš„ db.json æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚
2. è¾“å…¥ npx json-server --watch db.json å¯åŠ¨æœåŠ¡å™¨ã€‚
3. æœåŠ¡å™¨ä¼šç›‘å¬ 3000 ç«¯å£ï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®  json-server

### å…·ä½“æ“ä½œæµç¨‹

# ä½¿ç”¨åŸç”Ÿ AJAX æ“ä½œ JSON-server

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨åŸç”Ÿçš„ `XMLHttpRequest` å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯å¸¸è¯´çš„ AJAXï¼‰æ¥å’Œ `json-server` æä¾›çš„æ¥å£è¿›è¡Œäº¤äº’ï¼Œå®ç°æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚

å‡è®¾æˆ‘ä»¬çš„ `db.json` æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "posts": [
    { "id": 1, "title": "json-server", "author": "typicode" },
    { "id": 2, "title": "å­¦ä¹  AJAX", "author": "è–‡å§" }
  ],
  "comments": [
    { "id": 1, "body": "some comment", "postId": 1 }
  ],
  "profile": { "name": "typicode" }
}
```

å¹¶ä¸” `json-server` å·²ç»é€šè¿‡ `npx json-server --watch db.json` å¯åŠ¨åœ¨ `http://localhost:3000`ã€‚

## 1. æŸ¥è¯¢æ•°æ® (GET)

æŸ¥è¯¢æ•°æ®æ˜¯æœ€å¸¸è§çš„æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨ HTTP çš„ GET æ–¹æ³•ã€‚

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AJAX GET ç¤ºä¾‹</title>
</head>
<body>
    <h1>æ–‡ç« åˆ—è¡¨</h1>
    <ul id="posts-list"></ul>

    <script>
        // è·å–ç”¨äºæ˜¾ç¤ºæ–‡ç« çš„ <ul> å…ƒç´ 
        const postsList = document.getElementById('posts-list');

        // åˆ›å»ºä¸€ä¸ªæ–°çš„ XMLHttpRequest å¯¹è±¡
        const xhr = new XMLHttpRequest();

        // åˆå§‹åŒ–ä¸€ä¸ª GET è¯·æ±‚ï¼Œç›®æ ‡æ˜¯è·å–æ‰€æœ‰æ–‡ç« 
        // 'http://localhost:3000/posts' æ˜¯ json-server æä¾›çš„è·å– posts èµ„æºçš„æ¥å£
        // true è¡¨ç¤ºå¼‚æ­¥æ‰§è¡Œ
        xhr.open('GET', 'http://localhost:3000/posts', true);

        // è®¾ç½®è¯·æ±‚æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°
        xhr.onload = function() {
            // æ£€æŸ¥ HTTP çŠ¶æ€ç ï¼Œ200 è¡¨ç¤ºæˆåŠŸ
            if (xhr.status === 200) {
                // å°†æœåŠ¡å™¨è¿”å›çš„ JSON å­—ç¬¦ä¸²è§£æä¸º JavaScript å¯¹è±¡æ•°ç»„
                const posts = JSON.parse(xhr.responseText);
                
                // éå†æ–‡ç« æ•°æ®ï¼Œä¸ºæ¯ç¯‡æ–‡ç« åˆ›å»ºä¸€ä¸ªåˆ—è¡¨é¡¹å¹¶æ·»åŠ åˆ°é¡µé¢
                posts.forEach(post => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `ID: ${post.id}, æ ‡é¢˜: ${post.title}, ä½œè€…: ${post.author}`;
                    postsList.appendChild(listItem);
                });
            } else {
                // å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œåœ¨æ§åˆ¶å°æ‰“å°é”™è¯¯ä¿¡æ¯
                console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', xhr.status);
            }
        };

        // è®¾ç½®è¯·æ±‚å‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•° (ä¾‹å¦‚ç½‘ç»œé—®é¢˜)
        xhr.onerror = function() {
            console.error('è¯·æ±‚å‘ç”Ÿé”™è¯¯');
        };

        // å‘é€è¯·æ±‚
        xhr.send();
    </script>
</body>
</html>
```

## 2. æ·»åŠ æ•°æ® (POST)

æ·»åŠ æ–°çš„æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ HTTP çš„ POST æ–¹æ³•ï¼Œå¹¶åœ¨è¯·æ±‚ä½“ä¸­å‘é€è¦æ·»åŠ çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯ JSON æ ¼å¼ï¼‰ã€‚

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AJAX POST ç¤ºä¾‹</title>
</head>
<body>
    <h1>æ·»åŠ æ–°æ–‡ç« </h1>
    <button id="add-post-btn">æ·»åŠ æ–‡ç« </button>

    <script>
        const addPostBtn = document.getElementById('add-post-btn');

        addPostBtn.onclick = function() {
            // å‡†å¤‡è¦å‘é€çš„æ–°æ–‡ç« æ•°æ®
            const newPost = {
                title: "æˆ‘çš„æ–°æ–‡ç« ",
                author: "å­¦ä¹ è€…"
            };

            const xhr = new XMLHttpRequest();
            // åˆå§‹åŒ–ä¸€ä¸ª POST è¯·æ±‚
            xhr.open('POST', 'http://localhost:3000/posts', true);

            // è®¾ç½®è¯·æ±‚å¤´ï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬å‘é€çš„æ˜¯ JSON æ ¼å¼çš„æ•°æ®
            xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

            xhr.onload = function() {
                if (xhr.status === 201) { // 201 Created è¡¨ç¤ºèµ„æºåˆ›å»ºæˆåŠŸ
                    const createdPost = JSON.parse(xhr.responseText);
                    console.log('æ–‡ç« æ·»åŠ æˆåŠŸ:', createdPost);
                    alert(`æ–‡ç« æ·»åŠ æˆåŠŸï¼ID: ${createdPost.id}, æ ‡é¢˜: ${createdPost.title}`);
                } else {
                    console.error('æ·»åŠ å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', xhr.status);
                }
            };

            xhr.onerror = function() {
                console.error('è¯·æ±‚å‘ç”Ÿé”™è¯¯');
            };

            // å°† JavaScript å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²å¹¶å‘é€
            xhr.send(JSON.stringify(newPost));
        };
    </script>
</body>
</html>
```

## 3. ä¿®æ”¹æ•°æ® (PUT)

ä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ HTTP çš„ PUT æ–¹æ³•ã€‚éœ€è¦æŒ‡å®šè¦ä¿®æ”¹èµ„æºçš„ IDã€‚

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AJAX PUT ç¤ºä¾‹</title>
</head>
<body>
    <h1>ä¿®æ”¹æ–‡ç«  (ID: 1)</h1>
    <button id="update-post-btn">ä¿®æ”¹æ–‡ç« </button>

    <script>
        const updatePostBtn = document.getElementById('update-post-btn');

        updatePostBtn.onclick = function() {
            // å‡†å¤‡è¦æ›´æ–°çš„æ–‡ç« æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ ID ä¸º 1 çš„æ–‡ç« 
            const updatedPostData = {
                title: "json-server (å·²æ›´æ–°)",
                author: "typicodeå¤§ç¥"
            };
            // æ³¨æ„ï¼šPUT è¯·æ±‚é€šå¸¸éœ€è¦æä¾›å®Œæ•´çš„èµ„æºæ•°æ®ï¼Œå¦‚æœåªæƒ³æ›´æ–°éƒ¨åˆ†å­—æ®µï¼Œjson-server ä¹Ÿæ”¯æŒ PATCH æ–¹æ³•

            const postIdToUpdate = 1; // æŒ‡å®šè¦ä¿®æ”¹çš„æ–‡ç«  ID

            const xhr = new XMLHttpRequest();
            // åˆå§‹åŒ–ä¸€ä¸ª PUT è¯·æ±‚ï¼ŒURL ä¸­åŒ…å«è¦ä¿®æ”¹çš„èµ„æº ID
            xhr.open('PUT', `http://localhost:3000/posts/${postIdToUpdate}`, true);
            xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

            xhr.onload = function() {
                if (xhr.status === 200) { // 200 OK è¡¨ç¤ºæˆåŠŸ
                    const updatedPost = JSON.parse(xhr.responseText);
                    console.log('æ–‡ç« ä¿®æ”¹æˆåŠŸ:', updatedPost);
                    alert(`æ–‡ç«  (ID: ${updatedPost.id}) ä¿®æ”¹æˆåŠŸï¼æ–°æ ‡é¢˜: ${updatedPost.title}`);
                } else {
                    console.error('ä¿®æ”¹å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', xhr.status);
                }
            };

            xhr.onerror = function() {
                console.error('è¯·æ±‚å‘ç”Ÿé”™è¯¯');
            };

            xhr.send(JSON.stringify(updatedPostData));
        };
    </script>
</body>
</html>
```

## 4. åˆ é™¤æ•°æ® (DELETE)

åˆ é™¤æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ HTTP çš„ DELETE æ–¹æ³•ï¼ŒåŒæ ·éœ€è¦æŒ‡å®šè¦åˆ é™¤èµ„æºçš„ IDã€‚

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AJAX DELETE ç¤ºä¾‹</title>
</head>
<body>
    <h1>åˆ é™¤æ–‡ç«  (ID: 2)</h1>
    <button id="delete-post-btn">åˆ é™¤æ–‡ç« </button>

    <script>
        const deletePostBtn = document.getElementById('delete-post-btn');

        deletePostBtn.onclick = function() {
            const postIdToDelete = 2; // æŒ‡å®šè¦åˆ é™¤çš„æ–‡ç«  ID

            if (!confirm(`ç¡®å®šè¦åˆ é™¤ ID ä¸º ${postIdToDelete} çš„æ–‡ç« å—ï¼Ÿ`)) {
                return; // å¦‚æœç”¨æˆ·å–æ¶ˆï¼Œåˆ™ä¸æ‰§è¡Œåˆ é™¤æ“ä½œ
            }

            const xhr = new XMLHttpRequest();
            // åˆå§‹åŒ–ä¸€ä¸ª DELETE è¯·æ±‚ï¼ŒURL ä¸­åŒ…å«è¦åˆ é™¤çš„èµ„æº ID
            xhr.open('DELETE', `http://localhost:3000/posts/${postIdToDelete}`, true);

            xhr.onload = function() {
                // DELETE è¯·æ±‚æˆåŠŸé€šå¸¸è¿”å› 200 OK æˆ– 204 No Content
                if (xhr.status === 200 || xhr.status === 204) { 
                    console.log(`æ–‡ç«  (ID: ${postIdToDelete}) åˆ é™¤æˆåŠŸ`);
                    alert(`æ–‡ç«  (ID: ${postIdToDelete}) åˆ é™¤æˆåŠŸï¼`);
                } else {
                    console.error('åˆ é™¤å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', xhr.status);
                }
            };

            xhr.onerror = function() {
                console.error('è¯·æ±‚å‘ç”Ÿé”™è¯¯');
            };

            xhr.send(); // DELETE è¯·æ±‚é€šå¸¸ä¸éœ€è¦è¯·æ±‚ä½“
        };
    </script>
</body>
</html>
```

å­¦åˆ°è¿™é‡Œï¼Œå®ä½ å¯¹ `json-server` çš„åŸºæœ¬ä½¿ç”¨å’Œå¦‚ä½•é€šè¿‡åŸç”Ÿ AJAX è·Ÿå®ƒäº¤äº’åº”è¯¥æœ‰äº†ä¸ªå¤§æ¦‚çš„è®¤è¯†å•¦ï¼è¿™äº›éƒ½æ˜¯å‰ç«¯å¼€å‘ä¸­éå¸¸åŸºç¡€ä¸”é‡è¦çš„æŠ€èƒ½å“¦ã€‚å¤šåŠ¨æ‰‹æ•²æ•²ä»£ç ï¼Œé‡åˆ°é—®é¢˜åˆ«æ€•ï¼Œå¤§èƒ†å°è¯•ï¼Œå¾ˆå¿«å°±èƒ½æŒæ¡çš„ï¼åŠ æ²¹ï¼ğŸ’ª
